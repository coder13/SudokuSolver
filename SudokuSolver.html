<html>
<head>

  <!-- pastebin.com/pJq0GJBk -->
  
  <title>Sodoku Solver</title>
  <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
  <script type="text/javascript">

    // Initialize some state
    var myApp = {};

    myApp.data = [];
    randomFill();

    var h = 56;
    for (var i = 0; i < 9; i++) {
      var a = Math.floor(h/27)*27 + Math.floor(i/3)*9  +  Math.floor((h%9)/3)*3 + (i%3);

      console.log(a, myApp.data[a][0], isValid(h, 1));
      // console.log(i+1, isValid(h, i+1));
    }

    //Wait till the page is loaded to mess with the html
    document.addEventListener('DOMContentLoaded', function() {
      var gameDiv = document.getElementById("game");
      gameDiv.innerHTML = '';
      
      for (var i = 0; i < 9; i++) {
        var box = document.createElement("div");
        box.className = "box box" + i;
      
        for (var n = 0; n < 9; n++) {
          var input = document.createElement("input");
          var column = ((i % 3 * 3) + (n % 3));
          var row = ((Math.floor(n / 3)) + (Math.floor(i / 3) * 3));
          var index = row*9 + column;

          input.type = "text";
          input.value = (myApp.data[index][0]? myApp.data[index][0]: '');
          input.title = "inp" + index;
          input.maxLength = 1;
          input.id = "inp" + index;
          input.className = "col" + column;
          input.className += " row" + row;
          input.className += " box" + i;
          input.addEventListener("change", puzzleChanged);
          box.appendChild(input);
        };

        gameDiv.appendChild(box);
      };
    });

    function puzzleChanged (event) {
      // console.log(event);
      var index = parseInt(event.srcElement.id.replace("inp",""));
      var v = parseInt(event.srcElement.value);
      
      console.log(index + "\t" + v);
      if (v) {
        myApp.data[index] = [v, []];
      } else {
        event.srcElement.value = "";
      };

      genPossibilities();
      updateDisplay();
    }

    function isValid(index, n) {
      for (var i = 0; i < 9; i++) {
        if (myApp.data[Math.floor(index/9)*9 + i][0] == n || myApp.data[(index%9) + i*9][0] == n || // Row & Column
            myApp.data[Math.floor(index/27)*27 + Math.floor(i/3)*9  +  Math.floor((index%9)/3)*3 + (i%3)][0] == n) {       // Block 
          return false;
        } 
      }
      return true;
    }


    function genPossibilities () {
      for (var i = 0; i < 81; i++) {
        if (myApp.data[i][0] != 0)
          continue;
        myApp.data[i][1] = [];
        for (var n = 1; n <= 9; n++) {
          if (isValid(i, n)) {
            myApp.data[i][1].push(n);
          }
          
        }
        console.log(i + " - " + myApp.data[i][1]);

      }
    }

    function validatePuzzle () {
      var isValid = false;

      for (var i = 0; i < 9; i++) {
        
      }

      document.getElementById('info').innerHTML = (isValid? 'Works!' : 'Does not work!');
    }

    function reset() {
      for (var i = 0; i < 81; i++) {
        myApp.data[i] = [0, []];
      }
      updateDisplay();
    }

    function randomFill () {
      reset();
      for (var i = 0; i < 81; i++) {
        if (Math.random() < .25) {
          var r = Math.floor(Math.random()*10);
          myApp.data[i][0] = (isValid(i, r) ? r : 0);
        } else {
          myApp.data[i][0] = 0;

        };
      };
      genPossibilities();
      updateDisplay();
    }

    function updateDisplay () {
      console.log('--');
      for (var i = 0; i < 81; i++) {
        var myInp = document.getElementById("inp" + i);
        if (myInp) {
          myInp.value = (myApp.data[i][0]? myApp.data[i][0] : '');
          // myInp.title = (myApp.data[i][1]? myApp.data[i][1].toString() : "");
        }
      };
    }


    function solvePuzzle () {
      alert('not implemented')
    }

  </script>

  <style type="text/css">
    div.game {
      margin-left: 2px;
      width: 252px; /*228px*/
      height: 256px;
      text-align: center;
      float: left;
      clear: both;
    }
    
    div.box {
      width: 66px; /*74px*/
      border: 5px solid white;
      text-align: center;
      float: left;
    }

    div.box input {
      width: 20px;
      margin: 1px;
      border: 1px solid black;
      text-align: center;
      float: left;
    }

    div.controls {
      margin-left: 6px;
      float: left;
      width: 100%;
      display: inline;
    }

    #info {
      display: inline;
      margin-left: 10px;
    }s

  </style>

</head>
<body>

<!--
<div class="">
  <h2>Interesting Links:</h2>
  <a href="http://youmightnotneedjquery.com/">http://youmightnotneedjquery.com/</a><br>
  <a href="http://underscorejs.org/">http://underscorejs.org/</a><br>
</div>
-->

  <h2>The Game:</h2>
  
  <div id="controls" class="controls">
    <button id="SolveButton" onClick="solvePuzzle();">Solve</button>
    <button id="validateButton" onClick="validatePuzzle();">Validate</button>
    <button id="generateButton" onClick="randomFill();">generate</button>
    <p id="info"></p>
  </div>

  <br>
  <div id="game" class="game"></div>
  
  <div style="font-size:14px">
    <h4 style="margin: 0px; margin-top:10px">Example:</h4>
    <p>
      123  789  456<br>
      789  456  123<br>
      456  123  789<br>
      <br>
      231  897  564<br>
      564  231  897<br>
      897  564  231<br>
      <br>
      312  978  645<br>
      645  312  978<br>
      978  645  312<br>
    </p>
  </div>
</body>
</html>
